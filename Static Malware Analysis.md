

## Malware Scanning using Hybrid Analysis

Hybrid Analysis is a free service that analyzes suspicious files and URLs and facilitates the quick detection of unknown threats such as viruses, worms, Trojans, and other kinds of malware.

**Windows 11** machine selected. Login with **Admin**

Open any web browser (here, **Google Chrome**) and go to **https://www.hybrid-analysis.com** and press **Enter**.

The **HYBRID ANALYSIS** main page appears; click **Drag & Drop For Instant Analysis** section to upload a virus file.

If a cookie notification appears in the lower section of the page, then click **ACCEPT**

The **HYBRID ANALYSIS** main page appears; click **Drag & Drop For Instant Analysis** section to upload a virus file.

The **Open** window appears; navigate to Malware Threats\Viruses, select **tini.exe**, and click **Open**

**Getting Things Ready** page appears and the virus file begins to upload. Once it is uploaded, the status bar reaches **100%**, as shown in the screenshot.

Now, enter your personal mail in **Your E-mail** field and enter a comment in **Your Comment** field. Scroll-down to check the **I agree to the Hybrid Analysis Terms & Conditions and have read the Hybrid Analysis Privacy Notice explaining the processsing of personal data** checkbox and **I'm not a robot** checkbox. Click **Continue**.

**Analysis Environments** page appears, select **Windows 11 64 bit** radio-button and click **Generate Public Report**.

The report generation process initializes and after it completes, **Analysis Overview** page appears.
  
You can observe that the file is detected as **malicious** with threat score at 100 along with the additional information such as SHA value.

In the **Anti-Virus Results** section, you can observe the AV results obtained from different online resources such as **CrowdStrike Falcon** and **MetaDefender**.

To further view the complete information obtained by the online resources you can click this icon ( ![u17hjq7m.jpg](https://labondemand.blob.core.windows.net/content/lab168800/instructions255477/u17hjq7m.jpg)). Here, we will view the AV results obtained by the **MetaDefender**. Click **More Details** to open the result in the new tab.

A pop-up appears showing the **Anti-Virus Scan Results for OPSWAT Metadefender**. Close the pop-up window.

You can further scroll-down in the results page to view information related to Falcon reports and Incident Response.

Use other local and online malware scanning tools such as **Any.Run** (https://app.any.run) **Valkyrie Sandbox** (https://valkyrie.comodo.com), **JOESandbox Cloud** (https://www.joesandbox.com), **Jotti** (https://virusscan.jotti.org) to perform online malware scanning


## Analyze ELF Executable File using Detect It Easy (DIE)


In the **Windows 11** machine, navigate to Malware Threats\Malware Analysis Tools\Static Malware Analysis Tools\Packaging and Obfuscation Tools\DIE and double-click **die.exe**.
  
**Open File - Security Warning** appears, click **Run**

**Detect It Easy** window appears. Click ellipses icon next to the **File name** text field

The **Open file…** window appears; navigate to Malware Threats\Viruses, select **ELF Test File**, and click **Open**.

**Detect It Easy** automatically scans the file and result appears showing the Operating system, compiler and language details in the middle pane, as shown in the screenshot.

Now, check the **Advanced** checkbox present at the right pane.

Click **File info** button from the top left corner of the window. Info window appears, you can observe information such as File name, size, MD5, SHA1, Entropy, entry points, etc.
  
After viewing the information, close the window
  
Similarly, click **Hash** button from the top right corner of the window to view the information related to hash. Close the window after viewing the information

Click **Entropy** button from the top right corner of the window. Here, you can observe the status, size and graph of entropy. Close the window after viewing the Entrophy information
  
Similarly, you can further explore other functions such as MIME, Hex, Signatures and Demangle

Use other packaging/obfuscation tools such as **Macro_Pack** (https://github.com), **UPX** (https://upx.github.io), **ASPack** (http://www.aspack.com), or **VMprotect** (https://vmpsoft.com) to identify packing/obfuscation methods


## Perform Malware Disassembly using IDA and OllyDbg


In the **Windows** machine, search for **ida** in the Windows search, the **IDA Freeware 8.4** appears in the result, click **Open** to launch it
  
If the **IDA License** window appears, click on **I Agree**

**User interface telemetry** window appears, uncheck **Yes, I want to help improve IDA** checkbox and click **OK**.

The **IDA: Quick start** pop-up appears; click on **New** to select a malicious file for disassembly

The **IDA** main window appears, along with the **Select file to disassemble** window

In the **Select file to disassemble** window, navigate to Viruses\Klez Virus Live, select **face.exe**, and click **Open**

The **Load a new file** window appears; by default, the **Portable executable for 80386 (PE) [pe64.dll]** option selected; click **OK**.
  
IDA completes the analysis of the imported malicious file and displays the results in the **IDA View-A** tab, as shown in the screenshot
  
In the **IDA View-A** section, right-click anywhere and choose **Text view** from the context menu to view the text information of the malicious file uploaded to IDA for analysis.

This reveals the text view of the malicious file, allowing analysis of its information.

Maximize the IDA window. To view the flow of the uploaded malicious file, navigate to **View** --> **Graphs** and click **Flow chart**.

A **Graph** window appears with the flow. You may zoom in and adjust the screen to view this more clearly.
  
Close the **Graph** window, go to **View** --> **Graphs**, and click **Function calls** from the menu bar.
  
A window showing **call flow** appears; zoom in for a better view. Close the **WinGraph32 Call** **flow** window after completing the analysis.

Click the **HexView-1** tab to view the hex value of the malicious file.

Click the **Imports** tab to view list of all functions that the executable calls.

Close all open windows. In the **Save database** pop-up, click **OK**.

Navigate to Malware Analysis Tools\Static Malware Analysis Tools\Disassembling and Debugging Tools\OllyDbg and double-click **Ollydbg.exe**
If an **Open File - Security Warning** pop-up appears, click **Run**
  
If a **Old DLL** dialog box appears, click **Yes**
  
If an OllyDbg warning message appears, for administrative rights, click **OK**

The **OllyDbg** main window appears, as shown in the screenshot

When you launch OllyDbg for the first time, several sub-windows might appear in the main window of OllyDbg; close all of them

Choose **File** from the menu bar, and then choose **Open**

The **Select 32-bit executable** window appears; navigate to Module 07 Malware Threats\Viruses, select **tini.exe**, and click **Open**

The output appears in a window named **CPU - main thread, module tini**, maximize the window
  
A window named **Log data** appears in OllyDbg, displaying the log details

The **Log data** also displays the program entry point and its calls to known functions. Close the **Log data** window after completing the analysis

Choose **View** in the menu bar, and then choose **Executable modules**.

A window named **Executable modules** appears in OllyDbg, displaying all executable modules

Double-click any module to view the complete information of the selected module
  
In this task, we are choosing the **75750000** module. The results might differ when you perform this task

This will redirect you to the **CPU - main thread** window, as shown in the screenshot

Choose **View** in the menu bar, and then choose **Memory map**

A window named **Memory map** appears in OllyDbg, displaying all memory mappings, as shown in the screenshot. Close the **Memory map** window

Choose **View** in the menu bar, and then choose **Threads**

